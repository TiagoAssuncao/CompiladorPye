#.RECIPEPREFIX = A   <--- This is a comment used to remember... Ignore it...

CC = g++
FLAGS =

#all .c files on src folder
C_FILES = $(wildcard src/*.c)

#all .cc (c++) files on src folder
CC_FILES = $(wildcard src/*.cc) 

#all .o files that will be generated by its sources (.c and .cc files)
O_FILES = $(patsubst src/%.c, obj/%.o, $(C_FILES) $(CC_FILES))


.PHONY: all
all: bin/pye

bin/pye: scanner parser $(O_FILES)
	$(CC) $(FLAGS) $(O_FILES) -o bin/pye -I./inc

.PHONY: scanner
scanner:
	flex++ cmp/pye.l
	@mv lex.yy.cc src/

.PHONY: parser
parser:
	bison++ -d cmp/pye.y
	@mv y.tab.c src/
	@mv y.tab.h inc/

obj/%.o: src/%.c*
	$(CC) $(FLAGS) -c $< -o $@ -I./inc

.PHONY: run
run:
	@cat in.py | bin/./pye

.PHONY: show
show:
	@cat out.py 

.PHONY: clean
clean: 
	rm -rf obj/*
	rm -rf bin/*

.PHONY: everything
everything:
	make clean
	make
	make run
	clear
	@make show